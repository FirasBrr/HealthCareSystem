{% extends 'base.html.twig' %}
{% block title %}MedicalApp - Admin Dashboard{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        :root { --primary: #2c7be5; --primary-dark: #1a68d1; --secondary: #6e84a3; --success: #00d97e; --warning: #f6c343; --danger: #e63757; --light: #f9fbfd; --dark: #12263f; --gradient: linear-gradient(135deg, #2c7be5 0%, #6e84a3 100%); }
        .dashboard-section { background: #f5f7fb; min-height: 100vh; padding: 30px 0; }
        .welcome-card { background: var(--gradient); color: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(44, 123, 229, 0.2); position: relative; overflow: hidden; }
        .welcome-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 200%; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" opacity="0.1"><path fill="white" d="M500,250c138,0,250,112,250,250S638,750,500,750S250,638,250,500S362,250,500,250z"/></svg>') repeat; }
        .welcome-content { position: relative; z-index: 2; }
        .stats-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 25px rgba(0,0,0,0.08); border: none; transition: transform 0.3s ease; height: 100%; }
        .stats-card:hover { transform: translateY(-5px); }
        .stats-icon { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
        .stats-number { font-size: 2rem; font-weight: 700; color: var(--dark); display: block; line-height: 1; }
        .stats-label { color: var(--secondary); font-size: 0.9rem; font-weight: 500; }
        .quick-actions { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 25px rgba(0,0,0,0.08); }
        .action-item { display: flex; align-items: center; padding: 15px; border-radius: 10px; margin-bottom: 10px; transition: all 0.3s ease; text-decoration: none; color: var(--dark); }
        .action-item:hover { background: var(--light); transform: translateX(5px); text-decoration: none; color: var(--dark); }
        .action-icon { width: 40px; height: 40px; background: var(--gradient); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 15px; }

        /* Chart Styles */
        .chart-container { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 25px rgba(0,0,0,0.08); margin-bottom: 25px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-title { font-size: 1.1rem; font-weight: 600; color: var(--dark); margin: 0; }
        .chart-subtitle { font-size: 0.9rem; color: var(--secondary); }
        .simple-histogram-container { height: 250px; width: 100%; }

        /* Status Colors */
        .status-confirmed { background-color: var(--success); }
        .status-pending { background-color: var(--warning); }
        .status-cancelled { background-color: var(--danger); }

        .header-actions { display: flex; gap: 10px; align-items: center; }
        .btn-logout { background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 16px; border-radius: 8px; text-decoration: none; transition: all 0.3s ease; font-weight: 500; }
        .btn-logout:hover { background: rgba(255, 255, 255, 0.3); color: white; transform: translateY(-1px); }
    </style>
{% endblock %}

{% block body %}
    <section class="dashboard-section">
        <div class="container">
            <!-- Welcome Card -->
            <div class="welcome-card">
                <div class="welcome-content">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="display-6 fw-bold mb-3">Welcome, {{ app.user.firstName }}</h1>
                            <p class="mb-0 opacity-90">Here's your complete system overview and recent activities</p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="d-inline-block bg-opacity-20 px-4 py-3 rounded-pill">
                                <i class="fas fa-shield-alt me-2"></i>Administrator
                            </div>
                            <a href="{{ path('app_logout') }}" class="btn-logout">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-5">
                <div class="col-md-3 col-6">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: rgba(44, 123, 229, 0.1); color: var(--primary);">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="stats-number">{{ stats.totalUsers|default(0) }}</span>
                        <span class="stats-label">Total Users</span>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: rgba(0, 217, 126, 0.1); color: var(--success);">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <span class="stats-number">{{ stats.totalDoctors|default(0) }}</span>
                        <span class="stats-label">Doctors</span>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: rgba(246, 195, 67, 0.1); color: var(--warning);">
                            <i class="fas fa-procedures"></i>
                        </div>
                        <span class="stats-number">{{ stats.totalPatients|default(0) }}</span>
                        <span class="stats-label">Patients</span>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card">
                        <div class="stats-icon" style="background: rgba(230, 55, 87, 0.1); color: var(--danger);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <span class="stats-number">{{ stats.totalAppointments|default(0) }}</span>
                        <span class="stats-label">Total Appointments</span>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Quick Actions Sidebar -->
                <div class="col-lg-4">
                    <div class="quick-actions mb-4">
                        <h5 class="mb-4 fw-bold text-dark">
                            <i class="fas fa-bolt text-warning me-2"></i> Quick Actions
                        </h5>

                        <!-- REAL WORKING LINKS -->
                        <a href="{{ path('admin_appointments') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Appointments</h6>
                                <small class="text-muted">Schedule and manage bookings</small>
                            </div>
                        </a>

                        <a href="{{ path('admin_doctors') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Manage Doctors</h6>
                                <small class="text-muted">View and manage medical staff</small>
                            </div>
                        </a>

                        <a href="{{ path('admin_patients') }}" class="action-item">
                            <div class="action-icon">
                                <i class="fas fa-procedures"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Manage Patients</h6>
                                <small class="text-muted">Patient records and profiles</small>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Main Content - Simple Histogram Chart -->
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <h5 class="chart-title">Appointments by Status</h5>
                                <p class="chart-subtitle">Distribution of appointments based on their current status</p>
                            </div>
                        </div>

                        <div class="simple-histogram-container">
                            <canvas id="statusHistogram"></canvas>
                        </div>

                        <div class="row mt-4 text-center">
                            <div class="col-md-4">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <div class="status-confirmed rounded-circle me-2" style="width: 12px; height: 12px;"></div>
                                    <small class="text-muted">Confirmed: {{ stats.confirmedAppointments|default(0) }}</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <div class="status-pending rounded-circle me-2" style="width: 12px; height: 12px;"></div>
                                    <small class="text-muted">Pending: {{ stats.pendingAppointments|default(0) }}</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <div class="status-cancelled rounded-circle me-2" style="width: 12px; height: 12px;"></div>
                                    <small class="text-muted">Cancelled: {{ stats.cancelledAppointments|default(0) }}</small>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get data from your stats
            const confirmedCount = {{ stats.confirmedAppointments|default(0) }};
            const pendingCount = {{ stats.pendingAppointments|default(0) }};
            const cancelledCount = {{ stats.cancelledAppointments|default(0) }};

            // Get canvas context
            const ctx = document.getElementById('statusHistogram').getContext('2d');

            // Create simple histogram chart
            const histogramChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Confirmed', 'Pending', 'Cancelled'],
                    datasets: [{
                        data: [confirmedCount, pendingCount, cancelledCount],
                        backgroundColor: [
                            'rgba(0, 217, 126, 0.8)',   // Success - Green
                            'rgba(246, 195, 67, 0.8)',  // Warning - Yellow
                            'rgba(230, 55, 87, 0.8)'    // Danger - Red
                        ],
                        borderColor: [
                            'rgba(0, 217, 126, 1)',
                            'rgba(246, 195, 67, 1)',
                            'rgba(230, 55, 87, 1)'
                        ],
                        borderWidth: 1,
                        borderRadius: 6,
                        barPercentage: 0.5,
                        categoryPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const status = context.label;
                                    const count = context.raw;
                                    const total = confirmedCount + pendingCount + cancelledCount;
                                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                                    return `${status}: ${count} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6e84a3',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6e84a3',
                                font: {
                                    size: 11
                                },
                                padding: 10,
                                callback: function(value) {
                                    return value;
                                }
                            },
                            title: {
                                display: true,
                                text: 'Number of Appointments',
                                color: '#6e84a3',
                                font: {
                                    size: 12,
                                    weight: 'normal'
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // Add animation to stats cards
            const statsCards = document.querySelectorAll('.stats-card');
            statsCards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
            });
        });
    </script>
{% endblock %}