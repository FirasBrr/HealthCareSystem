<div class="modal-header border-0 pb-0 position-relative">
    <div class="w-100">
        <div class="d-flex align-items-center mb-3">
            <div class="modal-icon-wrapper me-3">
                <i class="fas fa-user-injured"></i>
            </div>
            <div>
                <h4 class="modal-title fw-bold text-dark mb-1">
                    {{ modal_title|default('Add New Patient') }}
                </h4>
                <p class="text-muted mb-0 small">Fill in the patient's personal and contact information</p>
            </div>
        </div>
    </div>
    <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body pt-1">
    <form method="post"
          action="{{ path(patient.id ? 'admin_patients_edit' : 'admin_patients_new', patient.id ? {id: patient.id} : {}) }}"
          id="patient-form"
          class="needs-validation"
          novalidate>

        <!-- Personal Information Section -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h6 class="section-title fw-semibold text-primary mb-0">Personal Information</h6>
            </div>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="form-floating">
                        {{ form_widget(form.firstName, {'attr': {
                            'class': 'form-control form-control-lg',
                            'placeholder': 'First Name',
                            'id': 'firstName'
                        }}) }}
                        {{ form_label(form.firstName, null, {
                            'label_attr': {'class': 'form-label'}
                        }) }}
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    {{ form_errors(form.firstName) }}
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        {{ form_widget(form.lastName, {'attr': {
                            'class': 'form-control form-control-lg',
                            'placeholder': 'Last Name',
                            'id': 'lastName'
                        }}) }}
                        {{ form_label(form.lastName, null, {
                            'label_attr': {'class': 'form-label'}
                        }) }}
                        <div class="input-icon">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    {{ form_errors(form.lastName) }}
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-address-book"></i>
                </div>
                <h6 class="section-title fw-semibold text-primary mb-0">Contact Information</h6>
            </div>
            <div class="row g-3">
                <div class="col-12">
                    <div class="form-floating">
                        {{ form_widget(form.email, {'attr': {
                            'class': 'form-control form-control-lg',
                            'placeholder': 'Email Address',
                            'id': 'email'
                        }}) }}
                        {{ form_label(form.email, null, {
                            'label_attr': {'class': 'form-label'}
                        }) }}
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    {{ form_errors(form.email) }}
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        {{ form_widget(form.plainPassword, {'attr': {
                            'class': 'form-control form-control-lg',
                            'placeholder': 'Password',
                            'id': 'password'
                        }}) }}
                        {{ form_label(form.plainPassword, null, {
                            'label_attr': {'class': 'form-label'}
                        }) }}
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    {{ form_errors(form.plainPassword) }}
                    {% if patient.id %}
                        <div class="form-hint">
                            <i class="fas fa-info-circle text-muted me-1"></i>
                            <small class="text-muted">Leave blank to keep current password</small>
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        {{ form_widget(form.phone, {'attr': {
                            'class': 'form-control form-control-lg',
                            'placeholder': 'Phone Number',
                            'id': 'phone'
                        }}) }}
                        {{ form_label(form.phone, null, {
                            'label_attr': {'class': 'form-label'}
                        }) }}
                        <div class="input-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                    </div>
                    {{ form_errors(form.phone) }}
                </div>
            </div>
        </div>

        <!-- Address Section -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <h6 class="section-title fw-semibold text-primary mb-0">Address Information</h6>
            </div>
            <div class="form-floating">
                {{ form_widget(form.address, {'attr': {
                    'class': 'form-control',
                    'placeholder': 'Full Address',
                    'id': 'address',
                    'style': 'height: 120px; resize: none;'
                }}) }}
                {{ form_label(form.address, null, {
                    'label_attr': {'class': 'form-label'}
                }) }}
                <div class="input-icon textarea-icon">
                    <i class="fas fa-home"></i>
                </div>
            </div>
            {{ form_errors(form.address) }}
            <div class="form-hint">
                <i class="fas fa-info-circle text-muted me-1"></i>
                <small class="text-muted">Enter the complete address including street, city, and zip code</small>
            </div>
        </div>

        {{ form_rest(form) }}

        <!-- Form Actions -->
        <div class="form-actions mt-4 pt-3 border-top">
            <div class="d-flex justify-content-between align-items-center">
                <div class="form-progress">
                    <div class="progress" style="height: 4px; width: 120px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted">All fields completed</small>
                </div>
                <div class="d-flex gap-3">
                    <button type="button" class="btn btn-outline-secondary btn-lg px-4 py-2" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg px-4 py-2 position-relative btn-submit">
                        <span class="loading-spinner"></span>
                        <i class="fas fa-{{ patient.id ? 'save' : 'user-plus' }} me-2"></i>
                        {{ patient.id ? 'Update Patient' : 'Create Patient Account' }}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .modal-icon-wrapper {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #2c7be5 0%, #1a68d1 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(44, 123, 229, 0.3);
    }

    .form-section {
        position: relative;
        margin-bottom: 2rem !important; /* Fixed gap between sections */
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding-bottom: 8px; /* Reduced padding */
        margin-bottom: 1.25rem !important; /* Reduced margin */
        border-bottom: 2px solid #f1f5fd;
    }

    .section-icon {
        width: 36px;
        height: 36px;
        background: rgba(44, 123, 229, 0.1);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #2c7be5;
        font-size: 0.9rem;
    }

    .section-title {
        color: #2c7be5;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-floating {
        position: relative;
    }

    .form-floating > .form-control {
        padding-left: 3rem;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        transition: all 0.3s ease;
        background: #fff;
    }

    .form-floating > .form-control:focus {
        border-color: #2c7be5;
        box-shadow: 0 0 0 0.2rem rgba(44, 123, 229, 0.15);
        background: #fff;
    }

    .form-floating > label {
        padding-left: 3rem;
        color: #6e84a3;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .form-floating > .form-control:focus ~ label,
    .form-floating > .form-control:not(:placeholder-shown) ~ label {
        color: #2c7be5;
        transform: scale(0.85) translateY(-0.9rem) translateX(-2.5rem);
    }

    .input-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6e84a3;
        z-index: 5;
        transition: all 0.3s ease;
    }

    .textarea-icon {
        top: 2rem;
        transform: none;
    }

    .form-floating > .form-control:focus ~ .input-icon {
        color: #2c7be5;
    }

    .form-hint {
        display: flex;
        align-items: center;
        font-size: 0.8rem;
        margin-top: 0.5rem !important; /* Reduced margin */
    }

    .form-actions {
        background: #f9fbfd;
        margin: -1.5rem; /* Reduced negative margin */
        margin-top: 1rem; /* Added top margin */
        padding: 1.5rem; /* Reduced padding */
        border-radius: 0 0 20px 20px;
    }

    .form-progress small {
        font-size: 0.75rem;
        margin-top: 4px;
        display: block;
    }

    .btn-submit {
        background: linear-gradient(135deg, #2c7be5 0%, #1a68d1 100%);
        border: none;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(44, 123, 229, 0.3);
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(44, 123, 229, 0.4);
    }

    .btn-outline-secondary {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
        border-color: #6e84a3;
        background-color: #f8f9fa;
    }

    /* Loading animation */
    .loading-spinner {
        display: none;
        width: 16px;
        height: 16px;
        border: 2px solid transparent;
        border-top: 2px solid #ffffff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-right: 8px;
    }

    .btn-loading .loading-spinner {
        display: inline-block;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Error states */
    .is-invalid {
        border-color: #e63757 !important;
    }

    .is-invalid ~ .input-icon {
        color: #e63757 !important;
    }

    .invalid-feedback {
        font-size: 0.8rem;
        margin-top: 4px;
        display: block;
    }

    /* Reduced gaps between form elements */
    .modal-body {
        padding-top: 0.5rem !important;
    }

    .form-section .row.g-3 {
        --bs-gutter-y: 1rem; /* Reduced gutter */
    }

    /* Responsive adjustments */
    @media (max-width: 576px) {
        .form-actions .d-flex {
            flex-direction: column;
            gap: 15px;
        }

        .form-progress {
            display: none;
        }

        .modal-icon-wrapper {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .form-actions {
            margin: -1rem;
            padding: 1.25rem;
        }
    }
</style>